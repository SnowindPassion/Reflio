let ReflioDomainRoot="https://reflio.com";const ReflioAPIRoot=(ReflioDomainRoot=window.location.href.includes("reflioTestingMode=true")?"http://localhost:3000":ReflioDomainRoot)+"/api/v1",rootDomain=window.location.origin,queryString=window.location.search,urlParams=new URLSearchParams(queryString),reflioVerifyParam=urlParams.get("reflioVerify"),reflioReferralParam=urlParams.get("via")?urlParams.get("via"):urlParams.get("ref")?urlParams.get("ref"):null;let reflioReferralObject=localStorage.getItem("reflioReferral");const reflioInnerScript=document.querySelector("script[data-reflio]");let scrolledPercentage=((document.documentElement.scrollTop+document.body.scrollTop)/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100).toFixed(0);class rfl{details(){return{companyId:reflioInnerScript.getAttribute("data-reflio")?reflioInnerScript.getAttribute("data-reflio"):null,rootDomain:rootDomain,domains:reflioInnerScript.getAttribute("data-domains")?reflioInnerScript.getAttribute("data-domains"):null,hidePopup:!!reflioInnerScript.getAttribute("hidePopup"),privacyCompliance:!!reflioInnerScript.getAttribute("privacyCompliance"),apiUrl:ReflioAPIRoot}}async checkDomainVerification(){return fetch(ReflioAPIRoot+"/verify-company").then(function(e){return e.json()})}async impression(e,o){return e&&o||console.warn("Reflio: could not track impression. Referral code / companyId not found."),fetch(ReflioAPIRoot+"/record-referral",{method:"POST",body:JSON.stringify({referralCode:e,companyId:o})}).then(function(e){return e.json()})}async campaignDetails(e,o){return e&&o||console.warn("Reflio: could not get campaign details. Referral code / companyId not found."),fetch(ReflioAPIRoot+"/campaign-details",{method:"POST",body:JSON.stringify({referralCode:e,companyId:o})}).then(function(e){return e.json()})}checkCookie(){var o="reflioData=";let e=decodeURIComponent(document.cookie);var t=e.split(";");for(let i=0;i<t.length;i++){let e=t[i];for(;" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(o))try{return JSON.parse(e.substring(o.length,e.length))}catch(e){return{error:!0}}}return null}deleteCookie(){return document.cookie="reflioData=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;","cookie_deleted"}consentRequired(){return!!(Intl.DateTimeFormat().resolvedOptions().timeZone&&0<=Intl.DateTimeFormat().resolvedOptions().timeZone.indexOf("Europe")&&!0===Reflio.details().privacyCompliance)}cookieEligible(){return null!==reflioReferralParam&&null!==Reflio.details().companyId&&null===Reflio.checkCookie()}cookieExists(){return null!==Reflio.checkCookie()}checkForOtherDomains(){return!(!Reflio.details().domains||null===Reflio.checkCookie())&&(Reflio.details().domains?.includes(",")&&document.querySelectorAll("[href]").forEach(t=>{let i=new URL(t.href);i.origin!==Reflio.details().rootDomain&&Reflio.details().domains.replace(/â€/g,"").split(",").map(e=>{if(i.origin===e.trim()){let e=i.searchParams;e.set("referral",Reflio.checkCookie()?.referral_id),i.search=e.toString();var o=i.toString();t.href=o}})}),!0)}consentCleanup(){document.getElementById("reflio-confirm-modal")&&document.getElementById("reflio-confirm-modal").parentNode.removeChild(document.getElementById("reflio-confirm-modal")),document.getElementById("reflio-confirm")&&document.getElementById("reflio-confirm").parentNode.removeChild(document.getElementById("reflio-confirm")),document.getElementById("reflio-confirm-styles")&&document.getElementById("reflio-confirm-styles").parentNode.removeChild(document.getElementById("reflio-confirm-styles")),document.getElementById("reflio-consent")&&document.getElementById("reflio-consent").parentNode.removeChild(document.getElementById("reflio-consent"))}async register(){var e;!0===Reflio.cookieEligible()&&(document.getElementById("reflio-confirm-button")&&(document.getElementById("reflio-confirm-button").innerText="Loading..."),(e=await Reflio.impression(reflioReferralParam,Reflio.details().companyId))?.referral_details?(document.cookie=`reflioData=${JSON.stringify(e?.referral_details)}; expires=`+e?.referral_details?.cookie_date,Reflio.checkForOtherDomains()):Reflio.consentCleanup())}async showPopup(){if(localStorage.getItem("reflioNoConsent"))return!1;const o=await Reflio.campaignDetails(reflioReferralParam,Reflio.details().companyId);if(!o?.campaign_details)return!1;var e=`
      <div id="reflio-confirm-modal">
        <div id="reflio-confirm">
          <div id="reflio-content-top">
          ${null!==o?.campaign_details?.discount_value&&"fixed"===o?.campaign_details?.discount_type&&o?.campaign_details?.company_currency?"<p id='reflio-content-title'>You've earned <span>"+o?.campaign_details?.company_currency+o?.campaign_details?.discount_value+" off</span> from a referral.</p>":null!==o?.campaign_details?.discount_value?"<p id='reflio-content-title'>You've earned <span>"+o?.campaign_details?.discount_value+"% off</span> from a referral.</p>":"<p id='reflio-content-title'>The person who sent you here can earn a referral."}
            <p id="reflio-content-subtitle">To receive the discount code, please confirm that you consent to using cookies.</p>
          </div>
          <div id="reflio-buttons">
            <div id="reflio-confirm-button">Accept cookie & get discount</div>
            <div id="reflio-cancel-button">No thanks</div>
          </div>
          <div id="reflio-content-bottom">
            <p>Please confirm that you're ok for a cookie to be set for our <span>privacy-friendly referral system</span>. The person who sent you here will earn a referral reward, and you'll be given a discount code to use on this site.</p>
          </div>
        </div>
      </div>
    `;if(document.getElementById("reflio-confirm")||(document.body.innerHTML+=e),setTimeout(()=>{document.getElementById("reflio-confirm-modal").classList.add("reflio-appear")},500),!document.getElementById("reflio-confirm-styles")){let e=document.createElement("style");e.type="text/css",e.innerText=`
        #reflio-confirm-modal {
          position: fixed;
          z-index: 2147483646;
          width: 100%;
          height: 100%;
          top: 0;
          left: 0;
          transition: all 0.4s ease-in-out;
          transition-delay: 1s;
        }
        #reflio-confirm-modal.reflio-appear {
          background-color: rgba(0,0,0,0.5);
        }
        #reflio-confirm {
          position: fixed;
          bottom: 0%;
          left: 50%;
          margin-bottom: 30px;
          transform: translate(-50%, 15%);
          text-align: center;
          font-family: ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";
          border-radius: 15px;
          overflow: hidden;
          z-index: 2147483647;
          background-color: #FFFFFF;
          border: 4px solid #c2c2c2;
          padding: 18px;
          width: 92%;
          max-width: 320px;
          box-shadow: 0 0 250px rgba(255,255,255,0.60);
          color: #000000;
          opacity: 0;
          transition: all 0.8s ease-in-out;
          transition-delay: 1.5s;
        }
        #reflio-confirm-modal.reflio-appear #reflio-confirm{
          opacity: 1;
          transform: translate(-50%, 0%);
        }
        #reflio-confirm * {
          box-sizing: border-box;
        }
        #reflio-content-top {
          width: 100%;
        }
        #reflio-content-title {
          font-size: 16px;
          line-height: 20px;
          font-weight: bold;
          margin-bottom: 8px;
        }
        #reflio-content-title span {
          text-decoration: underline; 
        }
        #reflio-content-subtitle {
          font-size: 15px;
          line-height: 20px;
        }
        #reflio-confirm-button {
          padding: 15px;
          border-radius: 15px;
          font-size: 16px;
          font-weight: bold;
          background: #ddd;
          cursor: pointer;
          margin-top: 15px;
          border: 2px solid #cccccc;
          color: #000;
        }
        #reflio-confirm-button:hover {
          background-color: #cccccc;
        }
        #reflio-cancel-button {
          margin-top: 10px;
          font-size: 12px;
          cursor: pointer;
          text-decoration: underline;
        }
        #reflio-content-bottom {
          width: 100%;
          margin-top: 15px;
          padding-bottom: 10px;
          border-top: 4px solid #e3e3e3;
        }
        #reflio-content-bottom p {
          margin-top: 15px;
          font-size: 13px;
          line-height: 18px;
          color: #848484;
        }
        #reflio-content-bottom span {
          font-weight: bold;
        }
        #reflio-buttons {
          width: 100%;
        }
        #reflio-discount-code {
          width: 100%;
        }
        #reflio-discount-code-input {
          font-size: 18px;
          font-weight: bold;
          padding: 10px 20px;
          background: #efefef;
          border: 4px solid #cccccc;
          width: 100%;
          display: block;
          margin-top: 10px;
          cursor: pointer;
          appearance: none;
          -webkit-appearance: none;
          text-align: center;
          color: #000;
        }
        #reflio-discount-code-text {
          margin-top: 10px;
        }
        #reflio-discount-code-text p {
          font-size: 14px;
          line-height: 19px;
          font-style: italic;
          font-weight: bold;
          color: #848484;
        }
        #reflio-close-button {
          margin-top: 10px;
          font-size: 16px;
          color: #000;
          font-weight: bold;
          cursor: pointer;
          text-decoration: underline;
        }
      `,e.setAttribute("id","reflio-confirm-styles"),document.head.appendChild(e)}document.getElementById("reflio-confirm-button")&&document.getElementById("reflio-confirm-button").addEventListener("click",function(){var e;document.getElementById("reflio-buttons")&&(e=`
            <div id="reflio-discount-code">
              <input value="${o?.campaign_details?.discount_code}" id="reflio-discount-code-input" type="text" name="reflio-discount-code-input"/>
            </div>
            <div>
              <div id="reflio-close-button">Close popup</div>
            </div>
          `,document.getElementById("reflio-buttons").innerHTML=e,document.getElementById("reflio-content-subtitle")&&(document.getElementById("reflio-content-subtitle").innerText="Use the below discunt code at checkout:"),document.getElementById("reflio-discount-code-input")&&o?.campaign_details?.discount_code&&document.getElementById("reflio-discount-code-input").addEventListener("click",function(){document.getElementById("reflio-discount-code-input").select(),document.execCommand("copy"),document.getElementById("reflio-discount-code").innerHTML+=`
                <div id="reflio-discount-code-text">
                  <p>Copied to clipboard</p>
                </div>
              `}),document.getElementById("reflio-close-button")&&document.getElementById("reflio-close-button").addEventListener("click",function(){Reflio.consentCleanup()})),Reflio.register()}),document.getElementById("reflio-cancel-button")&&document.getElementById("reflio-cancel-button").addEventListener("click",function(){Reflio.consentCleanup(),localStorage.setItem("reflioNoConsent",!0)})}async signup(e){if(console.log("Reflio: Running signup function"),!e||null===Reflio.checkCookie()||!Reflio.checkCookie().referral_id||!Reflio.checkCookie().cookie_date)return console.warn("Reflio: Signup could not be tracked."),!1;var o=await fetch(ReflioAPIRoot+"/signup-referral",{method:"POST",body:JSON.stringify({referralId:Reflio.checkCookie().referral_id,cookieDate:Reflio.checkCookie().cookie_date,email:e})}).then(function(e){return e.json()});return"error"!==o?.conversion_details?(console.log("Reflio: Running signup function successful"),Reflio.deleteCookie()):(console.warn("Reflio: Signup error:"),console.log(o)),o}}var Reflio=new rfl;function activatePopup(){33<=scrolledPercentage&&!1===Reflio.details().hidePopup&&!0===Reflio.consentRequired()&&!1===Reflio.cookieExists()&&setTimeout(()=>{Reflio.showPopup()},2e3)}null!==reflioVerifyParam&&"true"===reflioVerifyParam&&Reflio.checkDomainVerification().then(e=>{!0===e?.verified&&(console.log("Domain was verified:"),console.log("Redirect string: ",`${ReflioDomainRoot}/dashboard/${Reflio.details().companyId}/setup/verify`),window.location.href=`${ReflioDomainRoot}/dashboard/${Reflio.details().companyId}/setup/verify`)}),!1===Reflio.consentRequired()&&!0===Reflio.cookieEligible()&&Reflio.register(),document.addEventListener("DOMContentLoaded",function(){Reflio.checkForOtherDomains()}),activatePopup(),window.addEventListener("scroll",function e(){33<=(scrolledPercentage=((document.documentElement.scrollTop+document.body.scrollTop)/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100).toFixed(0))&&(window.removeEventListener("scroll",e,!1),activatePopup())},!1),!0===Reflio.cookieExists()&&Reflio.consentCleanup(),reflioInnerScript||console.error("Could not load Reflio: make sure the <script> tag includes data-reflio='<companyId>'");